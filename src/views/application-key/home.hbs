<!DOCTYPE html>
<html lang="en">

{{> head}}

<body>

	<div id="wrapper">

		{{> navbar}}

		{{> sidenav}}

		<div id="page-wrapper">
			<div class="row">
				<div class="col-lg-12">
					<h1 class="page-header">Api key</h1>
				</div>
			</div>
			<div class="row" style="word-wrap:break-word" >
				<div class="col-lg-12">
					{{#if success_message}}
						<div class="alert alert-success">
							{{success_message}}
						</div>
					{{/if}}
					{{#if warning_message}}
						<div class="alert alert-warning">
							{{warning_message}}
						</div>
					{{/if}}
					{{#if error_message}}
						<div class="alert alert-danger">
							{{error_message}}
						</div>
					{{/if}}
					{{#if error_security_message}}
						<div class="alert alert-danger">
							{{error_security_message}}
						</div>
					{{/if}}

					<div>
						{{#stringEquals userRole 'admin'}}
	              <a href="/application-key/action/reset" type="button" class="btn btn-outline btn-primary">Reset apikey</a>
						{{/stringEquals}}
						<br><br>
					</div>

					<div class="panel panel-default">
						<div class="panel-body">
							<div class="table-responsive">
								<table class="table table-bordered table-hover table-striped">
									<thead>
										<tr>
											<th>#</th>
											<th>Apikey</th>
										</tr>
									</thead>
									<tbody>
										{{#each applicationKey}}
											<tr class="table-row">
												<td>{{incremented @index}}</td>
												<td style="display: flex; justify-content: space-between;" class="btn-group btn-group-sm">
													<div class="input-group">
														<input type="password" id="inpApikey" class="form-control" value="{{this.apikey}}" readonly>
														<span class="input-group-btn">
															<a class="btn btn-default" href="/application-key/action/copy" aria-label="Left Align" title="Copy" id="copy">
																<span class="glyphicon glyphicon-copy" aria-hidden="true"></span> 
																Copy
															</a>
															<button type="button" class="btn btn-default" aria-label="Left Align" id="reveal">
																<span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span> 
																Reveal
															</button>
														</span>
													</div>
												</td>
											</tr>
										{{/each}}
									</tbody>
								</table>
							</div>
						</div>
					</div>
					<br>
					<br>
				</div>
			</div>
		</div>

		<!-- /#page-wrapper -->

	</div>
	<!-- /#wrapper -->

	{{> scripts}}
	<script>
			let btnCopy = document.getElementById('copy')
			let btnReveal = document.getElementById('reveal')
			let iconSpan = document.querySelector('#reveal span')
			let inpApikey = document.getElementById('inpApikey')

			btnCopy.addEventListener('click', () => {
				let inpTmp = document.createElement('input')
				inpTmp.value = inpApikey.value;

				try {
					document.body.appendChild(inpTmp)
					window.getSelection().removeAllRanges();

					inpTmp.select();

					document.execCommand('copy');

					window.getSelection().removeAllRanges();

					document.body.removeChild(inpTmp)
				} catch(err) {
					console.log(`ERROR COPY: ${err}`);
				}
			})

			btnReveal.addEventListener('click', () => {
				try {
					let inpType = inpApikey.getAttribute('type');
					let attrType = '';

					if (inpType == 'text'){
						attrType = 'password';
						iconSpan.classList.remove('glyphicon-eye-close');
						iconSpan.classList.add('glyphicon-eye-open');
					} else {
						attrType = 'text';
						iconSpan.classList.remove('glyphicon-eye-open');
						iconSpan.classList.add('glyphicon-eye-close');
					}

					inpApikey.setAttribute('type', attrType);
				} catch (err) {
					console.log(`ERROR REVEAL: ${err}`)
				}
			})
	</script>

</body>

</html>
